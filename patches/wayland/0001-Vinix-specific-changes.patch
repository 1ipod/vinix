From ae5b9715690051ae7a7d64b0542e030bcbfed5d0 Mon Sep 17 00:00:00 2001
From: mintsuki <mintsuki@protonmail.com>
Date: Wed, 12 Jan 2022 03:24:23 +0100
Subject: [PATCH] Vinix specific changes

---
 configure.ac         | 2 +-
 src/wayland-os.c     | 1 +
 src/wayland-server.c | 3 +++
 tests/test-runner.c  | 1 +
 4 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/configure.ac b/configure.ac
index 7f2f393..83d3d71 100644
--- a/configure.ac
+++ b/configure.ac
@@ -117,7 +117,7 @@ if test "x$enable_libraries" = "xyes"; then
 		      [[#include <time.h>]])
 fi
 
-PKG_CHECK_MODULES(EXPAT, [expat])
+#PKG_CHECK_MODULES(EXPAT, [expat])
 
 AM_CONDITIONAL([DTD_VALIDATION], [test "x$enable_dtd_validation" = "xyes"])
 if test "x$enable_dtd_validation" = "xyes"; then
diff --git a/src/wayland-os.c b/src/wayland-os.c
index 93b6f5f..fbb3dff 100644
--- a/src/wayland-os.c
+++ b/src/wayland-os.c
@@ -25,6 +25,7 @@
 
 #define _GNU_SOURCE
 
+#include <stddef.h>
 #include <sys/types.h>
 #include <sys/socket.h>
 #include <unistd.h>
diff --git a/src/wayland-server.c b/src/wayland-server.c
index d83bdec..360a068 100644
--- a/src/wayland-server.c
+++ b/src/wayland-server.c
@@ -1433,6 +1433,8 @@ wl_socket_lock(struct wl_socket *socket)
 {
 	struct stat socket_stat;
 
+	// Do not use lockfiles for now.
+/*
 	snprintf(socket->lock_addr, sizeof socket->lock_addr,
 		 "%s%s", socket->addr.sun_path, LOCK_SUFFIX);
 
@@ -1461,6 +1463,7 @@ wl_socket_lock(struct wl_socket *socket)
 		   socket_stat.st_mode & S_IWGRP) {
 		unlink(socket->addr.sun_path);
 	}
+*/
 
 	return 0;
 err_fd:
diff --git a/tests/test-runner.c b/tests/test-runner.c
index 8f08445..ba94c39 100644
--- a/tests/test-runner.c
+++ b/tests/test-runner.c
@@ -26,6 +26,7 @@
 #define _GNU_SOURCE
 
 #include <unistd.h>
+#include <signal.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <sys/types.h>
-- 
2.34.1

