name=v
version=93756d2027cad6c3f7295cbf6db99bc78d83ec6a
revision=1
tarball_url="https://github.com/vlang/v/archive/93756d2027cad6c3f7295cbf6db99bc78d83ec6a.tar.gz"
tarball_blake2b="d094d11bd095255ae59f7f7627bdbe5d8f2091593e5f0fa4f12e8b0639de9199a9efbde35dad97832e79595849841882ac1094816b29854be0398ed25c30815d"
source_imagedeps="curl"
source_allow_network="yes"
hostdeps="gcc"
deps="core-libs"

regenerate() {
    curl -o v.c https://raw.githubusercontent.com/vlang/vc/f1f618e8f4bd92957a7bccdb13df0c3c9b621a65/v.c
}

build() {
    cp -r ${source_dir}/. ./

    x86_64-vinix-gcc -O2 -pipe -w -std=gnu99 -fno-strict-aliasing v.c -o v
}

package() {
    x86_64-vinix-strip v

    rm -rf "${dest_dir}${prefix}"/v
    mkdir -p "${dest_dir}${prefix}"/v
    cp -r . "${dest_dir}${prefix}"/v/

    mkdir -p "${dest_dir}${prefix}"/bin
    ln -sf ../v/v "${dest_dir}${prefix}"/bin/v
}
